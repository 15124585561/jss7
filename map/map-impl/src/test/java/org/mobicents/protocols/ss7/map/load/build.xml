<project basedir="." default="server">
	<property name="packageprefix" value="org.mobicents.protocols.ss7.map.load" />
	<property name="root" value="../../../../../../../../.." />
	<property file="${root}/ant-build-config.properties" />
	<property name="classes" value="${root}/target/classes" />
	<property name="javac.source" value="1.7" />
	<property name="test-classes" value="${root}/target/test-classes" />
	<property name="srcroot" value="${root}/src" />
	<property name="log4j_jar" value="${M2_HOME}${log4j}" />
	<property name="junit_jar" value="${M2_HOME}${junit}" />
	<path id="project.class.path">
		<pathelement location="${test-classes}" />
		<pathelement location="${classes}" />
		<pathelement location="${M2_HOME}${log4j}" />
		<pathelement location="${M2_HOME}${junit}" />
		<pathelement location="${M2_HOME}${javolution}" />
		<pathelement location="${M2_HOME}${map-api}" />
		<pathelement location="${M2_HOME}${tcap-api}" />
		<pathelement location="${M2_HOME}${tcap-impl}" />
		<pathelement location="${M2_HOME}${sccp-api}" />
		<pathelement location="${M2_HOME}${sccp-impl}" />
		<pathelement location="${M2_HOME}${m3ua-api}" />
		<pathelement location="${M2_HOME}${m3ua-impl}" />
		<pathelement location="${M2_HOME}${mtp-api}" />
		<pathelement location="${M2_HOME}${asn}" />
		<pathelement location="${M2_HOME}${stream}" />
		<pathelement location="${root}/src/test/resources" />
	</path>

	<property name="myproperty" refid="project.class.path" />

	<target name="make">
		<echo message="${myproperty}" />
		<javac debug="true" source="${javac.source}" deprecation="${javac.deprecation}" debuglevel="${javac.debuglevel}" srcdir="${srcroot}" includes="test/java/org/mobicents/protocols/ss7/map/load/**/*.java" classpathref="project.class.path" destdir="${test-classes}">
		</javac>
	</target>


	<target name="server" depends="make" description="run the Load Test Server.">
		<echo message="${log4j_jar}" />
		<delete dir="server" />
		<mkdir dir="server" />
		<delete file="log4j-server.log" />
		<java classname="${packageprefix}.Server" fork="true" maxmemory="128m" classpathref="project.class.path" dir="server">
			<jvmarg value="-Dlog.file.name=log4j-server.log" />
			<!--
			<jvmarg value="-XX:+PrintGCDetails" />
			<jvmarg value="-XX:+PrintGCTimeStamps" />
			-->
		</java>
	</target>
	<target name="client" depends="make" description="run the Load Test Client">
		<delete dir="client" />
		<mkdir dir="client" />
		<java classname="${packageprefix}.Client" fork="true" maxmemory="128m" classpathref="project.class.path" dir="client">
			<jvmarg value="-Dlog.file.name=log4j-client.log" />
			<arg value="100" />
			<arg value="2" />
		</java>
	</target>

	<target name="clean" description="clean the logs">
		<delete dir="server" />
		<delete dir="client" />
	</target>


</project>
